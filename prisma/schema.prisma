generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  name              String
  email             String    @unique
  password          String
  role              String
  active            Boolean   @default(true)
  lastLogin         DateTime?
  resetToken        String?
  resetTokenExpires DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  @@map("users")
}

model Club {
  id               Int       @id @default(autoincrement())
  clubName         String
  affiliationNumber String
  uniqueNumber     String    @unique  // TDKA/(region abbrev)/TDKA01 format
  regionId         Int       // Foreign key to Region
  city             String
  address          String
  mobile          String
  email            String
  password         String
  
  // President details
  presidentName     String?
  presidentMobile   String?
  presidentEmail    String?
  presidentAadhar   String?
  
  // Secretary details
  secretaryName    String?
  secretaryMobile  String?
  secretaryEmail   String?
  secretaryAadhar  String?
  
  // Treasurer details
  treasurerName    String?
  treasurerMobile  String?
  treasurerEmail   String?
  treasurerAadhar  String?
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  region           Region    @relation(fields: [regionId], references: [id], onDelete: Restrict)
  competitions     Competition[]
  playerClubs      PlayerClub[]
  
  @@index([regionId])
}

model Group{
  id               Int       @id @default(autoincrement())
  groupName        String
  gender           String     
  age              String    
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  competitions     Competition[]
  players          Player[]
  @@map("groups")
}

model Taluka {
  id               Int       @id @default(autoincrement())
  number           Int       @unique // 2 digit number for that taluka
  abbreviation     String    @unique // abbreviation of that taluka
  talukaName       String    // taluka name
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  regions          Region[]  // One taluka can have many regions
  
  @@map("talukas")
}

model Region {
  id               Int       @id @default(autoincrement())
  number           Int       @unique // 2 digit number for that region
  abbreviation     String    @unique // abbreviation of that region
  regionName       String    // region name
  talukaId         Int       // Foreign key to Taluka
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  taluka           Taluka    @relation(fields: [talukaId], references: [id], onDelete: Cascade)
  clubs            Club[]    // One region can have many clubs
  
  @@index([talukaId])
  @@map("regions")
}

model Competition{
  id               Int       @id @default(autoincrement())
  competitionName  String
  maxPlayers       Int
  fromDate         String
  toDate           String
  age              String
  lastEntryDate    String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  groups           Group[]
  clubs            Club[]
}

model Player {
  id               Int       @id @default(autoincrement())
  uniqueIdNumber   String    @unique
  firstName        String
  middleName       String?
  lastName         String
  motherName       String?
  dateOfBirth      DateTime
  position         String?
  address          String
  mobile           String
  aadharNumber     String    @unique
  profileImage     String?   // Path to profile image
  aadharVerified   Boolean   @default(false)
  isSuspended      Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  groups           Group[]
  playerClubs      PlayerClub[]

  @@map("players")
}

model PlayerClub {
  id               Int       @id @default(autoincrement())
  playerId         Int
  clubId           Int
  isActive         Boolean   @default(false)
  joinedAt         DateTime  @default(now())
  leftAt           DateTime?
  transferReason   String?
  approvedBy       String?   // Who approved this transfer
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  player           Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  club             Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  
  // Ensure a player can only be active in one club at a time
  @@unique([playerId, isActive], name: "unique_active_player")
  @@index([playerId])
  @@index([clubId])
  @@index([isActive])
}