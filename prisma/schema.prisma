generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  name              String
  email             String    @unique
  password          String
  role              String
  active            Boolean   @default(true)
  lastLogin         DateTime?
  resetToken        String?
  resetTokenExpires DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  @@map("users")
}

model Club {
  id               Int       @id @default(autoincrement())
  clubName         String
  affiliationNumber String
  city             String
  address          String
  mobile          String
  email            String
  password         String
  
  // Chairman details
  chairmanName     String?
  chairmanMobile   String?
  chairmanEmail    String?
  chairmanAadhar   String?
  
  // Secretary details
  secretaryName    String?
  secretaryMobile  String?
  secretaryEmail   String?
  secretaryAadhar  String?
  
  // Treasurer details
  treasurerName    String?
  treasurerMobile  String?
  treasurerEmail   String?
  treasurerAadhar  String?
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  competitions     Competition[]
  playerClubs      PlayerClub[]
}

model Group{
  id               Int       @id @default(autoincrement())
  groupName        String
  gender           String     
  age              String    
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  competitions     Competition[]
  players          Player[]
  @@map("groups")
}

model Competition{
  id               Int       @id @default(autoincrement())
  competitionName  String
  maxPlayers       Int
  date             String
  age              String
  lastEntryDate    String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  groups           Group[]
  clubs            Club[]
}

model Player {
  id               Int       @id @default(autoincrement())
  uniqueIdNumber   String    @unique
  firstName        String
  middleName       String?
  lastName         String
  motherName       String?
  dateOfBirth      DateTime
  position         String?
  address          String
  mobile           String
  aadharNumber     String    @unique
  profileImage     String?   // Path to profile image
  aadharVerified   Boolean   @default(false)
  isSuspended      Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  groups           Group[]
  playerClubs      PlayerClub[]

  @@map("players")
}

model PlayerClub {
  id               Int       @id @default(autoincrement())
  playerId         Int
  clubId           Int
  isActive         Boolean   @default(false)
  joinedAt         DateTime  @default(now())
  leftAt           DateTime?
  transferReason   String?
  approvedBy       String?   // Who approved this transfer
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  player           Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  club             Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  
  // Ensure a player can only be active in one club at a time
  @@unique([playerId, isActive], name: "unique_active_player")
  @@index([playerId])
  @@index([clubId])
  @@index([isActive])
}